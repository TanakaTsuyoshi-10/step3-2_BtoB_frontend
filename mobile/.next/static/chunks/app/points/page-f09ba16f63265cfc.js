(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[908],{2567:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S});var a=s(5155),r=s(2115);function n(e){let{className:t="",...s}=e;return(0,a.jsx)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm ".concat(t),...s})}function i(e){let{className:t="",...s}=e;return(0,a.jsx)("div",{className:"p-4 text-gray-900 ".concat(t),...s})}function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}let c={variant:{default:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",destructive:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",outline:"border border-gray-300 bg-transparent hover:bg-gray-50 focus:ring-blue-500",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 focus:ring-gray-500",ghost:"hover:bg-gray-100 focus:ring-gray-500",link:"text-blue-600 underline-offset-4 hover:underline focus:ring-blue-500"},size:{default:"h-10 px-4 py-2",sm:"h-9 px-3 text-sm",lg:"h-11 px-8 text-base",icon:"h-10 w-10"}},d=r.forwardRef((e,t)=>{let{className:s,variant:r="default",size:n="default",disabled:i,...d}=e;return(0,a.jsx)("button",{className:l("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium transition-colors","focus:outline-none focus:ring-2 focus:ring-offset-2","disabled:pointer-events-none disabled:opacity-50",c.variant[r],c.size[n],s),ref:t,disabled:i,...d})});d.displayName="Button";let o={variant:{default:"bg-blue-100 text-blue-800 border-transparent",secondary:"bg-gray-100 text-gray-800 border-transparent",destructive:"bg-red-100 text-red-800 border-transparent",outline:"text-gray-600 border-gray-200 bg-transparent"}};function x(e){let{className:t,variant:s="default",...r}=e;return(0,a.jsx)("div",{className:l("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",o.variant[s],t),...r})}let u=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},h=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var m={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let p=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:l="",children:c,iconNode:d,...o}=e;return(0,r.createElement)("svg",{ref:t,...m,width:a,height:a,stroke:s,strokeWidth:i?24*Number(n)/Number(a):n,className:h("lucide",l),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...d.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(c)?c:[c]])}),y=(e,t)=>{let s=(0,r.forwardRef)((s,a)=>{let{className:n,...i}=s;return(0,r.createElement)(p,{ref:a,iconNode:t,className:h("lucide-".concat(u(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),n),...i})});return s.displayName=u(e),s},g=y("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),f=y("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),b=y("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),v=y("gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),j=y("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);async function N(e,t){let s=await fetch("".concat("***").concat(e),{headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},cache:"no-store",...t});if(!s.ok){let t=await s.text().catch(()=>"");throw Error("API ".concat(e," failed: ").concat(s.status," ").concat(t))}return s.json()}async function w(){return N("/api/v1/mobile/products")}async function k(e){return N("/api/v1/mobile/redeem?product_id=".concat(e),{method:"POST"})}async function _(){return N("/api/v1/mobile/points/balance")}async function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return N("/api/v1/mobile/points/history?limit=".concat(e))}function S(){var e;let[t,s]=(0,r.useState)([]),[l,c]=(0,r.useState)(null),[o,u]=(0,r.useState)([]),[h,m]=(0,r.useState)(!0),[p,y]=(0,r.useState)(null),[N,S]=(0,r.useState)(null);(0,r.useEffect)(()=>{C()},[]);let C=async()=>{try{m(!0);let[e,t,a]=await Promise.all([w(),_(),A(10)]);s(e),c(t),u(a.history||[])}catch(e){console.error("Failed to load data:",e),S({type:"error",text:"データの読み込みに失敗しました"})}finally{m(!1)}},L=async(e,t,s)=>{if(!l||l.current_balance<s)return void S({type:"error",text:"ポイントが不足しています"});try{y(e);let s=await k(e);S({type:"success",text:"".concat(t,"と交換しました！残りポイント: ").concat(s.new_balance,"pt")}),await C()}catch(e){console.error("Failed to redeem:",e),S({type:"error",text:"交換に失敗しました。もう一度お試しください。"})}finally{y(null)}};return h?(0,a.jsx)("div",{className:"min-h-dvh bg-gray-50 text-gray-900",children:(0,a.jsx)("div",{className:"max-w-md mx-auto p-4",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded-xl"}),(0,a.jsx)("div",{className:"h-48 bg-gray-200 rounded-xl"}),(0,a.jsx)("div",{className:"h-48 bg-gray-200 rounded-xl"})]})})}):(0,a.jsx)("div",{className:"min-h-dvh bg-gray-50 text-gray-900",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto p-4 space-y-4",children:[N&&(0,a.jsxs)("div",{className:"p-4 rounded-xl flex items-center space-x-2 ".concat("success"===N.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["success"===N.type?(0,a.jsx)(g,{className:"w-5 h-5"}):(0,a.jsx)(f,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-sm",children:N.text})]}),(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"p-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(b,{className:"w-6 h-6 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"現在のポイント"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[(null==l||null==(e=l.current_balance)?void 0:e.toLocaleString())||0,"pt"]})]})]})})})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center space-x-2",children:[(0,a.jsx)(v,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"交換できる商品"})]}),0===t.length?(0,a.jsx)(n,{children:(0,a.jsxs)(i,{className:"p-6 text-center",children:[(0,a.jsx)(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-500",children:"現在交換可能な商品がありません"})]})}):(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between space-x-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsx)(x,{variant:"secondary",className:"text-xs",children:e.category}),(0,a.jsxs)("span",{className:"text-sm font-medium text-blue-600",children:[e.points_required.toLocaleString(),"pt"]}),e.stock<=5&&(0,a.jsxs)(x,{variant:"destructive",className:"text-xs",children:["残り",e.stock,"個"]})]})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(d,{size:"sm",onClick:()=>L(e.id,e.title,e.points_required),disabled:p===e.id||!l||l.current_balance<e.points_required||e.stock<=0,className:"whitespace-nowrap",children:p===e.id?"交換中...":"交換する"})})]})})},e.id))})]}),o.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center space-x-2",children:[(0,a.jsx)(j,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"最近の履歴"})]}),(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"p-0",children:(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:o.map(e=>(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900 truncate",children:e.reason}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)("span",{className:"text-sm font-medium ".concat("earn"===e.type?"text-green-600":"text-red-600"),children:["earn"===e.type?"+":"",e.delta.toLocaleString(),"pt"]})})]},e.id))})})})]})]})})}},7592:(e,t,s)=>{Promise.resolve().then(s.bind(s,2567))}},e=>{e.O(0,[441,255,358],()=>e(e.s=7592)),_N_E=e.O()}]);